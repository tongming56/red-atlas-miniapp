<!-- çŸ¥è¯†å›¾è°±é¡µ -->
<view class="graph-container">
  <!-- å…³ç³»ç½‘ç»œå›¾ (Obsidiané£æ ¼) - å›ºå®šåŒºåŸŸï¼Œä¸éšé¡µé¢æ»šåŠ¨ -->
  <view class="relation-graph">
    <view class="graph-header">
      <view>
        <text class="graph-title">çŸ¥è¯†å›¾è°±</text>
        <text class="graph-hint">ğŸ‘† é•¿æŒ‰æ‹–åŠ¨èŠ‚ç‚¹</text>
      </view>
      <text class="graph-subtitle">{{graphNodeCount}} ä¸ªèŠ‚ç‚¹</text>
    </view>

    <!-- Canvas ç”»å¸ƒå®¹å™¨ -->
    <view class="canvas-container">
      <canvas
        type="2d"
        id="knowledgeGraph"
        class="graph-canvas"
        catchtouchstart="handleTouchStart"
        catchtouchmove="handleTouchMove"
        catchtouchend="handleTouchEnd"
        disable-scroll="{{true}}"
        bindtouchcancel="handleTouchEnd"
      ></canvas>
    </view>

    <!-- å›¾ä¾‹ -->
    <view class="graph-legend">
      <view class="legend-item">
        <view class="legend-dot legend-center"></view>
        <text class="legend-text">å»ºç­‘</text>
        <image class="legend-icon" src="/assets/icons/monument.svg" mode="aspectFit" />
      </view>
      <view class="legend-item">
        <view class="legend-dot legend-people"></view>
        <text class="legend-text">äººç‰©</text>
        <image class="legend-icon" src="/assets/icons/person.svg" mode="aspectFit" />
      </view>
      <view class="legend-item">
        <view class="legend-dot legend-event"></view>
        <text class="legend-text">äº‹ä»¶</text>
        <image class="legend-icon" src="/assets/icons/calendar.svg" mode="aspectFit" />
      </view>
      <view class="legend-item">
        <view class="legend-dot legend-building"></view>
        <text class="legend-text">å…³è”</text>
        <image class="legend-icon" src="/assets/icons/monument.svg" mode="aspectFit" />
      </view>
    </view>
  </view>

  <!-- æ»šåŠ¨å†…å®¹åŒºåŸŸ - åªåŒ…å«ä¸‹é¢çš„è¯¦ç»†ä¿¡æ¯ -->
  <scroll-view class="content-scroll" scroll-y>
    <!-- ç›¸å…³äººç‰© -->
    <view class="section" wx:if="{{building.relatedPeople && building.relatedPeople.length > 0}}">
      <view class="section-header">
        <image class="section-icon" src="/assets/icons/person.svg" mode="aspectFit" />
        <view class="section-title">ç›¸å…³äººç‰©</view>
        <view class="section-count">{{building.relatedPeople.length}}</view>
      </view>
      <view class="person-list">
        <view class="person-card" wx:for="{{building.relatedPeople}}" wx:key="name">
          <view class="person-avatar">{{item.avatar}}</view>
          <view class="person-info">
            <view class="person-name">{{item.name}}</view>
            <view class="person-role">{{item.role}}</view>
            <view class="person-desc">{{item.description}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- é‡è¦äº‹ä»¶ -->
    <view class="section" wx:if="{{building.relatedEvents && building.relatedEvents.length > 0}}">
      <view class="section-header">
        <image class="section-icon" src="/assets/icons/calendar.svg" mode="aspectFit" />
        <view class="section-title">é‡è¦äº‹ä»¶</view>
        <view class="section-count">{{building.relatedEvents.length}}</view>
      </view>
      <view class="event-list">
        <view class="event-card" wx:for="{{building.relatedEvents}}" wx:key="date">
          <view class="event-date">{{item.date}}</view>
          <view class="event-content">
            <view class="event-title">{{item.title}}</view>
            <view class="event-desc">{{item.description}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- å…³è”å»ºç­‘ -->
    <view class="section" wx:if="{{building.relatedBuildings && building.relatedBuildings.length > 0}}">
      <view class="section-header">
        <image class="section-icon" src="/assets/icons/monument.svg" mode="aspectFit" />
        <view class="section-title">å…³è”å»ºç­‘</view>
        <view class="section-count">{{building.relatedBuildings.length}}</view>
      </view>
      <view class="building-list">
        <view
          class="building-card"
          wx:for="{{building.relatedBuildings}}"
          wx:key="id"
          bindtap="goToBuilding"
          data-id="{{item.id}}"
        >
          <image class="building-image" src="{{item.image}}" mode="aspectFill" />
          <view class="building-info">
            <view class="building-name">{{item.name}}</view>
            <view class="building-relation">{{item.relation}}</view>
          </view>
          <image class="arrow-icon" src="/assets/icons/chevron-right-gray.svg" mode="aspectFit" />
        </view>
      </view>
    </view>

    <!-- æ—¶é—´çº¿ -->
    <view class="section" wx:if="{{building.timeline && building.timeline.length > 0}}">
      <view class="section-header">
        <image class="section-icon" src="/assets/icons/timeline.svg" mode="aspectFit" />
        <view class="section-title">å†å²æ—¶é—´çº¿</view>
      </view>
      <view class="timeline">
        <view class="timeline-item" wx:for="{{building.timeline}}" wx:key="year">
          <view class="timeline-dot"></view>
          <view class="timeline-line" wx:if="{{index < building.timeline.length - 1}}"></view>
          <view class="timeline-content">
            <view class="timeline-year">{{item.year}}</view>
            <view class="timeline-event">{{item.event}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨å ä½ -->
    <view class="bottom-placeholder"></view>
  </scroll-view>
</view>
