<!-- çŸ¥è¯†å›¾è°±é¡µ -->
<view class="graph-container">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="nav-bar" style="padding-top: {{statusBarHeight + 10}}px;">
    <button class="nav-button" bindtap="goBack" hover-class="nav-button-hover">
      <image class="nav-icon" src="/assets/icons/chevron-left-white.svg" mode="aspectFit" />
    </button>
    <view class="nav-title">çŸ¥è¯†å›¾è°±</view>
    <view class="nav-placeholder"></view>
  </view>

  <!-- æ»šåŠ¨å†…å®¹åŒºåŸŸ -->
  <scroll-view class="content-scroll" scroll-y>
    <!-- ä¸­å¿ƒå»ºç­‘å¡ç‰‡ -->
    <view class="center-node">
      <view class="node-card building-node">
        <view class="node-icon">ğŸ›</view>
        <view class="node-info">
          <view class="node-title">{{building.name}}</view>
          <view class="node-subtitle">{{building.city}}</view>
        </view>
        <view class="node-badge">ä¸­å¿ƒ</view>
      </view>
    </view>

    <!-- å…³ç³»ç½‘ç»œå›¾ (Obsidiané£æ ¼) -->
    <view class="relation-graph">
      <view class="graph-header">
        <view>
          <text class="graph-title">çŸ¥è¯†å›¾è°±</text>
          <text class="graph-hint">ğŸ‘† é•¿æŒ‰æ‹–åŠ¨èŠ‚ç‚¹</text>
        </view>
        <text class="graph-subtitle">{{graphNodeCount}} ä¸ªèŠ‚ç‚¹</text>
      </view>

      <!-- Canvas ç”»å¸ƒ (Canvas 2D æ–°ç‰ˆAPI) -->
      <canvas
        type="2d"
        id="knowledgeGraph"
        class="graph-canvas"
        bindtouchstart="handleTouchStart"
        bindtouchmove="handleTouchMove"
        bindtouchend="handleTouchEnd"
      ></canvas>

      <!-- å›¾ä¾‹ -->
      <view class="graph-legend">
        <view class="legend-item">
          <view class="legend-dot legend-center"></view>
          <text class="legend-text">å»ºç­‘ ğŸ›</text>
        </view>
        <view class="legend-item">
          <view class="legend-dot legend-people"></view>
          <text class="legend-text">äººç‰© ğŸ‘¤</text>
        </view>
        <view class="legend-item">
          <view class="legend-dot legend-event"></view>
          <text class="legend-text">äº‹ä»¶ ğŸ“…</text>
        </view>
        <view class="legend-item">
          <view class="legend-dot legend-building"></view>
          <text class="legend-text">å…³è” ğŸ›</text>
        </view>
      </view>
    </view>

    <!-- ç›¸å…³äººç‰© -->
    <view class="section" wx:if="{{building.relatedPeople && building.relatedPeople.length > 0}}">
      <view class="section-header">
        <view class="section-icon">ğŸ‘¤</view>
        <view class="section-title">ç›¸å…³äººç‰©</view>
        <view class="section-count">{{building.relatedPeople.length}}</view>
      </view>
      <view class="person-list">
        <view class="person-card" wx:for="{{building.relatedPeople}}" wx:key="name">
          <view class="person-avatar">{{item.avatar}}</view>
          <view class="person-info">
            <view class="person-name">{{item.name}}</view>
            <view class="person-role">{{item.role}}</view>
            <view class="person-desc">{{item.description}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- é‡è¦äº‹ä»¶ -->
    <view class="section" wx:if="{{building.relatedEvents && building.relatedEvents.length > 0}}">
      <view class="section-header">
        <view class="section-icon">ğŸ“…</view>
        <view class="section-title">é‡è¦äº‹ä»¶</view>
        <view class="section-count">{{building.relatedEvents.length}}</view>
      </view>
      <view class="event-list">
        <view class="event-card" wx:for="{{building.relatedEvents}}" wx:key="date">
          <view class="event-date">{{item.date}}</view>
          <view class="event-content">
            <view class="event-title">{{item.title}}</view>
            <view class="event-desc">{{item.description}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- å…³è”å»ºç­‘ -->
    <view class="section" wx:if="{{building.relatedBuildings && building.relatedBuildings.length > 0}}">
      <view class="section-header">
        <view class="section-icon">ğŸ›</view>
        <view class="section-title">å…³è”å»ºç­‘</view>
        <view class="section-count">{{building.relatedBuildings.length}}</view>
      </view>
      <view class="building-list">
        <view
          class="building-card"
          wx:for="{{building.relatedBuildings}}"
          wx:key="id"
          bindtap="goToBuilding"
          data-id="{{item.id}}"
        >
          <image class="building-image" src="{{item.image}}" mode="aspectFill" />
          <view class="building-info">
            <view class="building-name">{{item.name}}</view>
            <view class="building-relation">{{item.relation}}</view>
          </view>
          <image class="arrow-icon" src="/assets/icons/chevron-right-gray.svg" mode="aspectFit" />
        </view>
      </view>
    </view>

    <!-- æ—¶é—´çº¿ -->
    <view class="section" wx:if="{{building.timeline && building.timeline.length > 0}}">
      <view class="section-header">
        <view class="section-icon">â±</view>
        <view class="section-title">å†å²æ—¶é—´çº¿</view>
      </view>
      <view class="timeline">
        <view class="timeline-item" wx:for="{{building.timeline}}" wx:key="year">
          <view class="timeline-dot"></view>
          <view class="timeline-line" wx:if="{{index < building.timeline.length - 1}}"></view>
          <view class="timeline-content">
            <view class="timeline-year">{{item.year}}</view>
            <view class="timeline-event">{{item.event}}</view>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨å ä½ -->
    <view class="bottom-placeholder"></view>
  </scroll-view>
</view>
