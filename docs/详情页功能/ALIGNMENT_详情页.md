# 详情页功能 - 需求对齐文档

## 📋 基本信息

- **任务名称**：福建红色图谱小程序 - 详情页功能开发
- **创建时间**：2026-01-30
- **优先级**：P0（阻塞级）
- **预估工时**：4-5小时

---

## 🎯 原始需求

### 用户需求
用户希望实现微信小程序的详情页功能，当从首页、搜索、扫码、收藏等页面点击建筑卡片时，能够查看该建筑的完整详细信息。

### 业务价值
- **核心页面**：详情页是整个小程序的信息中心，所有其他页面最终都指向详情页
- **阻塞因素**：当前详情页只有占位符，导致用户无法查看任何建筑的详细信息
- **用户体验**：完善详情页是小程序可用的关键

---

## 🔍 项目上下文分析

### 现有项目架构
```
福建红色图谱小程序
├── 已完成页面
│   ├── 首页（建筑列表）
│   ├── 搜索页（全文搜索）
│   ├── 扫码页（二维码识别）
│   └── 收藏页（收藏管理）
├── 待开发页面
│   ├── 详情页（本次任务）← 阻塞项
│   ├── 地图页（占位）
│   ├── 3D模型页（占位）
│   └── 知识图谱页（占位）
└── 自定义组件
    └── 底部TabBar（已完成）
```

### 技术栈
- **框架**：微信小程序原生开发
- **语言**：JavaScript + WXML + WXSS
- **样式系统**：自定义CSS（类似Tailwind）
- **主色调**：#B71C1C（革命红）
- **导航模式**：自定义导航栏（navigationStyle: custom）

### 现有代码模式
1. **页面结构**：使用 Page() 构造器
2. **数据绑定**：通过 setData() 更新
3. **样式单位**：rpx（响应式像素）
4. **导航方式**：wx.navigateTo() / wx.navigateBack()
5. **状态栏适配**：statusBarHeight 动态计算

---

## 📊 详情页入口分析

### 4个主要入口
| 入口 | 触发条件 | 参数格式 | 传递数据 |
|------|---------|---------|---------|
| **首页** | 点击建筑卡片 | `?id={id}` | id, name, city, image, tags |
| **搜索页** | 点击搜索结果 | `?id={id}` | 同上 |
| **扫码页** | 扫码成功/点击历史 | `?id={id}` | id, name, nameEn, location, image |
| **收藏页** | 点击收藏项 | `?id={id}` | id, name, location, image, time |

### 参数传递统一性
✅ **所有入口均使用 `?id=<building_id>` 格式**
✅ **id 字段在所有数据源中保持一致**

---

## 📦 现有数据结构

### Building 对象（当前）
```javascript
{
  id: 1,                    // 唯一标识
  name: '古田会议会址',      // 建筑名称
  city: '龙岩市 · 上杭县',   // 位置信息
  image: 'https://...',     // 背景图URL
  tags: ['全国重点', '教育基地']  // 标签数组
}
```

### 详情页需要的完整数据（扩展）
```javascript
{
  // 基础信息（已有）
  id: Number,
  name: String,

  // 详情页新增字段
  nameEn: String,           // 英文名称
  address: String,          // 详细地址
  description: String,      // 建筑简介
  image: String,            // 顶部大图
  images: Array,            // 相册图片数组

  // 标签和分类
  tags: Array,              // 标签
  category: String,         // 分类（如：会议旧址、纪念馆）

  // 访问信息
  phoneNumber: String,      // 联系电话
  openTime: String,         // 开放时间
  ticketPrice: String,      // 门票价格

  // 地理位置
  latitude: Number,         // 纬度
  longitude: Number,        // 经度

  // 统计信息
  views: Number,            // 浏览次数
  rating: Number,           // 评分

  // 关联内容
  has3DModel: Boolean,      // 是否有3D模型
  hasKnowledgeGraph: Boolean, // 是否有知识图谱
  relatedSites: Array       // 相关地点
}
```

---

## 🎨 设计规范参考

### 来自 QUICK_START.md 的设计说明

#### 页面布局结构
1. **顶部大图区**（340px高度）
   - 背景图片
   - 渐变遮罩（从透明到黑色）
   - 自定义导航栏

2. **导航栏**（自定义）
   - 左侧：返回按钮（圆形半透明）
   - 右侧：分享按钮 + 更多按钮

3. **标题信息区**
   - 徽章标识
   - 建筑名称（大标题）
   - 浏览次数

4. **圆角内容卡片**
   - 地址信息
   - 简介文字
   - 功能服务按钮（4个）
   - 开放信息
   - 相关照片

5. **底部操作栏**（固定）
   - 收藏按钮
   - 分享按钮
   - 导航按钮

#### 功能服务按钮（4个）
- 3D全景查看 → 跳转到 `/pages/model3d/model3d?id={id}`
- 知识图谱 → 跳转到 `/pages/graph/graph?id={id}`
- 联系电话 → 调用 `wx.makePhoneCall()`
- 参观预约 → 弹窗或跳转预约页面

### 样式规范
- **字体大小**：标题 36-40rpx，正文 28-32rpx，辅助 24rpx
- **圆角**：卡片 24-32rpx，按钮 16rpx
- **间距**：大间距 32rpx，中间距 24rpx，小间距 16rpx
- **颜色**：主色 #B71C1C，背景 #F8F9FA，卡片 #FFFFFF

---

## ❓ 需求边界确认

### 明确的需求范围
✅ 实现详情页的完整UI布局
✅ 根据URL参数id加载建筑详情
✅ 实现收藏功能（与全局收藏列表关联）
✅ 实现分享功能
✅ 实现导航跳转（地图页）
✅ 实现电话拨打功能
✅ 实现3D模型、知识图谱入口

### 不在本次范围内
❌ 后端API开发（后续任务）
❌ 3D模型页面实现（占位即可）
❌ 知识图谱页面实现（占位即可）
❌ 预约功能完整开发（简单提示即可）
❌ 用户登录认证系统

### 数据来源策略
**阶段1（本次）**：使用本地 Mock 数据
- 在 detail.js 中定义测试数据
- 模拟完整的 Building 对象
- 数据量：3-5条测试数据

**阶段2（后续）**：接入真实API
- 从后端加载数据
- 用户收藏同步到服务器
- 浏览次数实时更新

---

## 🔧 技术约束

### 微信小程序限制
1. **导航栈深度**：最多10层
2. **图片大小**：单张图片不超过2MB
3. **本地存储**：单个key不超过1MB
4. **网络请求**：需要配置合法域名

### 项目约束
1. **使用自定义导航栏**：需要适配不同机型的statusBarHeight
2. **复用现有组件**：底部TabBar已存在，不要重复
3. **保持样式一致**：使用项目现有的颜色和字体规范
4. **响应式设计**：使用rpx单位，适配不同屏幕

---

## 🎯 疑问澄清

### Q1: 收藏功能的持久化方式？
**决策**：
- **阶段1**：使用 `app.globalData.favorites` 全局变量
- **阶段2**：使用 `wx.setStorageSync()` 本地存储
- **阶段3**：同步到后端服务器

### Q2: 建筑详情数据从哪里来？
**决策**：
- **阶段1**：在 `detail.js` 中写死 Mock 数据（3-5条）
- 根据传入的 id 匹配对应的建筑对象
- 如果 id 不存在，显示"建筑信息不存在"

### Q3: 3D模型和知识图谱按钮点击后做什么？
**决策**：
- 检查 `building.has3DModel` 和 `building.hasKnowledgeGraph` 字段
- 如果为 `true`，跳转到对应页面（当前是占位页）
- 如果为 `false`，显示 Toast："该建筑暂无3D模型"

### Q4: 分享功能如何实现？
**决策**：
- 使用微信小程序的 `onShareAppMessage()` 生命周期
- 分享标题：建筑名称
- 分享图片：建筑主图
- 分享路径：`/pages/detail/detail?id={id}`

### Q5: 导航功能跳转到哪里？
**决策**：
- 跳转到地图页：`/pages/map/map?id={id}`
- 传递建筑的经纬度信息
- 地图页当前是占位页，后续开发

### Q6: 预约功能如何处理？
**决策**：
- 阶段1：点击后显示 Toast："预约功能开发中"
- 阶段2：弹出预约表单（姓名、电话、时间）
- 阶段3：提交到后端服务器

---

## ✅ 验收标准

### 功能完整性
- [ ] 从任意入口跳转到详情页，能正确显示对应建筑信息
- [ ] 顶部大图、标题、地址、简介正确显示
- [ ] 返回按钮功能正常
- [ ] 收藏按钮可以切换状态（已收藏/未收藏）
- [ ] 分享功能正常（生成分享卡片）
- [ ] 电话按钮可以拨打电话
- [ ] 导航按钮跳转到地图页
- [ ] 3D模型、知识图谱按钮有响应（跳转或提示）

### UI质量
- [ ] 适配不同机型的状态栏高度
- [ ] 图片加载显示占位符
- [ ] 圆角卡片布局美观
- [ ] 颜色符合设计规范（#B71C1C主色）
- [ ] 字体大小合理
- [ ] 按钮点击有视觉反馈

### 代码质量
- [ ] 代码结构清晰，注释完整
- [ ] 数据绑定正确，无内存泄漏
- [ ] 错误处理完善（如id不存在、图片加载失败）
- [ ] 符合微信小程序最佳实践

---

## 📝 备注说明

### 依赖关系
- **前置依赖**：首页、搜索、扫码、收藏页（已完成）
- **后置依赖**：地图页、3D模型页、知识图谱页（本次不实现）
- **数据依赖**：本次使用Mock数据，不依赖后端

### 风险提示
⚠️ **图片资源**：当前使用Google图片链接，可能需要替换为国内CDN
⚠️ **导航栏适配**：不同机型的刘海屏、水滴屏需要测试
⚠️ **收藏同步**：暂时只保存在内存和全局变量，刷新后丢失

### 后续优化方向
1. 接入真实后端API
2. 添加骨架屏加载动画
3. 图片懒加载优化
4. 添加评论区功能
5. 添加浏览历史记录

---

## 🎯 下一步行动

**立即进入 Architect 阶段**：
1. 设计详情页的模块架构
2. 定义组件拆分策略
3. 规划数据流向
4. 设计Mock数据结构
5. 绘制页面布局图

---

**文档版本**：v1.0
**创建时间**：2026-01-30
**负责人**：Claude Sonnet 4.5
**状态**：等待用户确认
